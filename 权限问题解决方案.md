# 🔐 权限问题解决方案

## ❌ 错误信息

```
AnchorError thrown in programs/prediction-market/src/instructions/admin/configure.rs:324
Error Code: IncorrectAuthority
Error Number: 6004
Error Message: IncorrectAuthority
```

## 🎯 问题原因

合约的授权管理员地址是：
```
2eExwMwQPhsAKXKygjpA6VChkr1iMgPugjrX47F6Tkyr
```

但你使用的钱包地址不是这个，所以没有权限初始化配置。

---

## ✅ 解决方案

### 方案 1: 使用授权钱包（推荐）

#### 步骤 1: 导入授权钱包

如果你有授权钱包的私钥：

1. 打开 Phantom 钱包
2. 点击设置 → 添加/连接钱包
3. 选择"导入私钥"
4. 输入私钥
5. 切换到这个钱包

#### 步骤 2: 初始化配置

使用授权钱包访问：
```
http://localhost:3000/admin/initialize
```

---

### 方案 2: 使用命令行（如果有密钥文件）

如果你有 `~/.config/solana/id.json` 文件且地址是 `2eExwMwQPhsAKXKygjpA6VChkr1iMgPugjrX47F6Tkyr`：

```bash
# 检查当前钱包地址
solana address --url devnet

# 如果地址匹配，运行初始化脚本
cd contract
ts-node scripts/initialize-program.ts
```

---

### 方案 3: 修改前端使用任意钱包（临时测试）

如果只是为了测试，可以修改合约让任何人都能初始化（**仅用于测试！**）

#### 创建测试初始化页面

我将创建一个特殊的测试页面，跳过权限检查：

```typescript
// 使用当前连接的钱包作为 admin
const configParams = {
  admin: wallet.publicKey,  // 使用当前钱包
  teamWallet: wallet.publicKey,
  // ... 其他参数
};
```

---

### 方案 4: 重新部署合约（开发环境）

如果这是开发环境，可以重新部署合约并使用你的钱包作为授权地址：

```bash
cd contract

# 1. 更新 Anchor.toml 中的钱包路径
# wallet = "~/.config/solana/id.json"

# 2. 重新构建
anchor build

# 3. 重新部署
anchor deploy --provider.cluster devnet

# 4. 更新前端的 Program ID
```

---

## 🔍 检查当前钱包地址

### 在浏览器中

打开浏览器控制台（F12），运行：
```javascript
window.solana.publicKey.toString()
```

### 使用 Solana CLI

```bash
solana address --url devnet
```

---

## 📋 快速测试方案（推荐）

由于这是测试环境，我建议使用**方案 3**：创建一个测试版本的初始化功能。

### 创建测试初始化脚本

我将创建一个脚本，使用你当前的钱包创建一个测试市场，而不需要初始化全局配置。

---

## 🎯 立即可用的解决方案

### 选项 A: 跳过全局配置（快速测试）

我将修改前端代码，让你可以直接创建市场而不需要全局配置。这样你可以立即测试所有功能。

### 选项 B: 使用授权钱包

如果你能访问授权钱包（地址：`2eExwMwQPhsAKXKygjpA6VChkr1iMgPugjrX47F6Tkyr`），使用它来初始化配置。

---

## 🚀 我推荐的方案

让我为你创建一个**无需全局配置的测试版本**，这样你可以：

1. ✅ 直接创建市场
2. ✅ 测试所有交易功能
3. ✅ 不需要管理员权限

这个方案最适合快速测试和开发。

---

## 📞 需要帮助？

告诉我你想使用哪个方案：

1. **方案 1**: 我有授权钱包的私钥
2. **方案 2**: 我有 `~/.config/solana/id.json` 文件
3. **方案 3**: 创建测试版本（推荐）
4. **方案 4**: 重新部署合约

我会根据你的选择提供详细步骤。
