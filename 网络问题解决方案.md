# 🌐 网络问题解决方案

## 🎉 好消息

错误从 `InvalidParameter` 变成了 `Failed to fetch`！

这说明：
- ✅ 参数问题已解决
- ✅ 权限问题已解决
- ❌ 现在是网络连接问题

---

## 🔍 "Failed to fetch" 错误原因

### 1. RPC 端点不稳定
公共 RPC 端点（`https://api.devnet.solana.com`）可能：
- 请求过多
- 临时不可用
- 响应超时

### 2. 网络连接问题
- 本地网络不稳定
- 防火墙阻止
- DNS 解析问题

### 3. CORS 问题
- 浏览器安全策略
- RPC 端点配置

---

## ✅ 已添加的修复

### 1. 自动重试机制
代码现在会自动重试 3 次，每次间隔 2 秒。

### 2. 详细日志
控制台会显示每次尝试的结果。

---

## 🚀 现在测试

### 步骤 1: 刷新页面
```
http://localhost:3000/admin/initialize
```

### 步骤 2: 连接钱包

### 步骤 3: 点击初始化

控制台会显示：
```
📤 尝试发送交易 (1/3)...
```

如果第一次失败，会自动重试：
```
❌ 尝试 1 失败: Failed to fetch
⏳ 等待 2 秒后重试...
📤 尝试发送交易 (2/3)...
```

---

## 💡 如果还是失败

### 方案 A: 使用其他 RPC 端点

#### 1. Helius (推荐)
免费，更稳定：
```
https://devnet.helius-rpc.com/?api-key=YOUR_KEY
```

注册：https://www.helius.dev/

#### 2. QuickNode
```
https://YOUR_ENDPOINT.devnet.quiknode.pro/YOUR_KEY/
```

注册：https://www.quiknode.com/

#### 3. Alchemy
```
https://solana-devnet.g.alchemy.com/v2/YOUR_KEY
```

注册：https://www.alchemy.com/

### 方案 B: 检查网络连接

```bash
# 测试 RPC 连接
curl https://api.devnet.solana.com -X POST -H "Content-Type: application/json" -d '{"jsonrpc":"2.0","id":1,"method":"getHealth"}'

# 应该返回：{"jsonrpc":"2.0","result":"ok","id":1}
```

### 方案 C: 等待并重试

有时公共 RPC 只是暂时不可用，等待几分钟后重试。

---

## 🔧 更换 RPC 端点

### 步骤 1: 编辑 .env.local

```bash
# x402-polymarket-frontend/.env.local
NEXT_PUBLIC_SOLANA_RPC_ENDPOINT=https://devnet.helius-rpc.com/?api-key=YOUR_KEY
```

### 步骤 2: 重启开发服务器

```bash
# 停止当前服务器 (Ctrl+C)
# 重新启动
cd x402-polymarket-frontend
pnpm dev
```

### 步骤 3: 刷新页面并重试

---

## 📊 RPC 端点对比

| 提供商 | 免费额度 | 稳定性 | 速度 |
|--------|----------|--------|------|
| Solana 公共 | 无限 | ⭐⭐ | ⭐⭐ |
| Helius | 100k/天 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| QuickNode | 有限 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| Alchemy | 有限 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ |

---

## 🎯 推荐方案

### 短期（立即测试）
1. **刷新页面重试** - 自动重试机制可能会成功
2. **等待几分钟** - RPC 可能只是暂时不可用
3. **检查网络** - 确保网络连接正常

### 长期（稳定开发）
1. **注册 Helius** - 免费且稳定
2. **配置 RPC 端点** - 更新 `.env.local`
3. **重启服务器** - 使用新的 RPC

---

## 🔍 调试信息

### 查看详细错误

打开浏览器控制台（F12），查看：
1. Network 标签 - 查看失败的请求
2. Console 标签 - 查看详细错误信息

### 常见错误信息

#### "Failed to fetch"
- 网络连接问题
- RPC 端点不可用

#### "429 Too Many Requests"
- 请求过多
- 需要使用付费 RPC 或等待

#### "Timeout"
- 请求超时
- RPC 响应太慢

---

## ✅ 成功标志

当成功时，你会看到：

```
📤 尝试发送交易 (1/3)...
✅ 交易成功: [签名]

✅ Configuration initialized successfully!
Transaction: [签名]
View on explorer:
https://explorer.solana.com/tx/[签名]?cluster=devnet
```

---

## 🚀 现在就试试

1. **刷新页面**
2. **点击初始化**
3. **等待自动重试**
4. **如果失败，考虑更换 RPC**

---

**大部分情况下，重试几次就会成功！** 🎉
